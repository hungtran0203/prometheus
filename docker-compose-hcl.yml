name: hashicorp-stack

services:
  # HashiCorp Vault for secrets management
  hc-vault:
    image: hashicorp/vault:1.15
    container_name: hc-vault
    ports:
      - "8200:8200"  # Standard Vault port
    volumes:
      - vault_data:/vault/data
    cap_add:
      - IPC_LOCK
    command: server -dev
    environment:
      - VAULT_DEV_ROOT_TOKEN_ID=root
      - VAULT_DEV_LISTEN_ADDRESS=0.0.0.0:8200
    restart: on-failure
    networks:
      - hashicorp_network
      - monitoring_network

  # HashiCorp Consul for service discovery and configuration
  hc-consul:
    image: hashicorp/consul:1.15
    container_name: hc-consul
    ports:
      - "8600:8500"  # HTTP API and UI on a different port
      - "8601:8600/tcp"  # DNS interface (TCP)
      - "8601:8600/udp"  # DNS interface (UDP)
    volumes:
      - ./consul/config:/consul/config
      - ./consul/data:/consul/data
    command: agent -dev -client=0.0.0.0
    restart: on-failure
    networks:
      - hashicorp_network
      - monitoring_network

volumes:
  vault_data:
  vault_logs:

networks:
  hashicorp_network:
    name: hashicorp_network
  monitoring_network:
    external: true
    name: prometheus_monitoring_network 